{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/ricar/source/repos/kabudjy/Doyou2/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { UserManager } from 'oidc-client';\nimport { BehaviorSubject, concat, from } from 'rxjs';\nimport { filter, map, mergeMap, take, tap } from 'rxjs/operators';\nimport { ApplicationPaths, ApplicationName } from './api-authorization.constants';\nimport * as i0 from \"@angular/core\";\nexport var AuthenticationResultStatus;\n(function (AuthenticationResultStatus) {\n  AuthenticationResultStatus[AuthenticationResultStatus[\"Success\"] = 0] = \"Success\";\n  AuthenticationResultStatus[AuthenticationResultStatus[\"Redirect\"] = 1] = \"Redirect\";\n  AuthenticationResultStatus[AuthenticationResultStatus[\"Fail\"] = 2] = \"Fail\";\n})(AuthenticationResultStatus || (AuthenticationResultStatus = {}));\nexport class AuthorizeService {\n  constructor() {\n    // By default pop ups are disabled because they don't work properly on Edge.\n    // If you want to enable pop up authentication simply set this flag to false.\n    this.popUpDisabled = true;\n    this.userSubject = new BehaviorSubject(null);\n  }\n  isAuthenticated() {\n    return this.getUser().pipe(map(u => !!u));\n  }\n  getUser() {\n    return concat(this.userSubject.pipe(take(1), filter(u => !!u)), this.getUserFromStorage().pipe(filter(u => !!u), tap(u => this.userSubject.next(u))), this.userSubject.asObservable());\n  }\n  getAccessToken() {\n    return from(this.ensureUserManagerInitialized()).pipe(mergeMap(() => from(this.userManager.getUser())), map(user => user && user.access_token));\n  }\n  // We try to authenticate the user in three different ways:\n  // 1) We try to see if we can authenticate the user silently. This happens\n  //    when the user is already logged in on the IdP and is done using a hidden iframe\n  //    on the client.\n  // 2) We try to authenticate the user using a PopUp Window. This might fail if there is a\n  //    Pop-Up blocker or the user has disabled PopUps.\n  // 3) If the two methods above fail, we redirect the browser to the IdP to perform a traditional\n  //    redirect flow.\n  signIn(state) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.ensureUserManagerInitialized();\n      let user = null;\n      try {\n        user = yield _this.userManager.signinSilent(_this.createArguments());\n        _this.userSubject.next(user.profile);\n        return _this.success(state);\n      } catch (silentError) {\n        // User might not be authenticated, fallback to popup authentication\n        console.log('Silent authentication error: ', silentError);\n        try {\n          if (_this.popUpDisabled) {\n            throw new Error('Popup disabled. Change \\'authorize.service.ts:AuthorizeService.popupDisabled\\' to false to enable it.');\n          }\n          user = yield _this.userManager.signinPopup(_this.createArguments());\n          _this.userSubject.next(user.profile);\n          return _this.success(state);\n        } catch (popupError) {\n          if (popupError.message === 'Popup window closed') {\n            // The user explicitly cancelled the login action by closing an opened popup.\n            return _this.error('The user closed the window.');\n          } else if (!_this.popUpDisabled) {\n            console.log('Popup authentication error: ', popupError);\n          }\n          // PopUps might be blocked by the user, fallback to redirect\n          try {\n            yield _this.userManager.signinRedirect(_this.createArguments(state));\n            return _this.redirect();\n          } catch (redirectError) {\n            console.log('Redirect authentication error: ', redirectError);\n            return _this.error(redirectError);\n          }\n        }\n      }\n    })();\n  }\n  completeSignIn(url) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this2.ensureUserManagerInitialized();\n        const user = yield _this2.userManager.signinCallback(url);\n        _this2.userSubject.next(user && user.profile);\n        return _this2.success(user && user.state);\n      } catch (error) {\n        console.log('There was an error signing in: ', error);\n        return _this2.error('There was an error signing in.');\n      }\n    })();\n  }\n  signOut(state) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        if (_this3.popUpDisabled) {\n          throw new Error('Popup disabled. Change \\'authorize.service.ts:AuthorizeService.popupDisabled\\' to false to enable it.');\n        }\n        yield _this3.ensureUserManagerInitialized();\n        yield _this3.userManager.signoutPopup(_this3.createArguments());\n        _this3.userSubject.next(null);\n        return _this3.success(state);\n      } catch (popupSignOutError) {\n        console.log('Popup signout error: ', popupSignOutError);\n        try {\n          yield _this3.userManager.signoutRedirect(_this3.createArguments(state));\n          return _this3.redirect();\n        } catch (redirectSignOutError) {\n          console.log('Redirect signout error: ', redirectSignOutError);\n          return _this3.error(redirectSignOutError);\n        }\n      }\n    })();\n  }\n  completeSignOut(url) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      yield _this4.ensureUserManagerInitialized();\n      try {\n        const response = yield _this4.userManager.signoutCallback(url);\n        _this4.userSubject.next(null);\n        return _this4.success(response && response.state);\n      } catch (error) {\n        console.log(`There was an error trying to log out '${error}'.`);\n        return _this4.error(error);\n      }\n    })();\n  }\n  createArguments(state) {\n    return {\n      useReplaceToNavigate: true,\n      data: state\n    };\n  }\n  error(message) {\n    return {\n      status: AuthenticationResultStatus.Fail,\n      message\n    };\n  }\n  success(state) {\n    return {\n      status: AuthenticationResultStatus.Success,\n      state\n    };\n  }\n  redirect() {\n    return {\n      status: AuthenticationResultStatus.Redirect\n    };\n  }\n  ensureUserManagerInitialized() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      if (_this5.userManager !== undefined) {\n        return;\n      }\n      const response = yield fetch(ApplicationPaths.ApiAuthorizationClientConfigurationUrl);\n      if (!response.ok) {\n        throw new Error(`Could not load settings for '${ApplicationName}'`);\n      }\n      const settings = yield response.json();\n      settings.automaticSilentRenew = true;\n      settings.includeIdTokenInSilentRenew = true;\n      _this5.userManager = new UserManager(settings);\n      _this5.userManager.events.addUserSignedOut( /*#__PURE__*/_asyncToGenerator(function* () {\n        yield _this5.userManager.removeUser();\n        _this5.userSubject.next(null);\n      }));\n    })();\n  }\n  getUserFromStorage() {\n    return from(this.ensureUserManagerInitialized()).pipe(mergeMap(() => this.userManager.getUser()), map(u => u && u.profile));\n  }\n}\nAuthorizeService.ɵfac = function AuthorizeService_Factory(t) {\n  return new (t || AuthorizeService)();\n};\nAuthorizeService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthorizeService,\n  factory: AuthorizeService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["UserManager","BehaviorSubject","concat","from","filter","map","mergeMap","take","tap","ApplicationPaths","ApplicationName","AuthenticationResultStatus","AuthorizeService","constructor","isAuthenticated","getUser","pipe","u","userSubject","getUserFromStorage","next","asObservable","getAccessToken","ensureUserManagerInitialized","userManager","user","access_token","signIn","state","signinSilent","createArguments","profile","success","silentError","console","log","popUpDisabled","Error","signinPopup","popupError","message","error","signinRedirect","redirect","redirectError","completeSignIn","url","signinCallback","signOut","signoutPopup","popupSignOutError","signoutRedirect","redirectSignOutError","completeSignOut","response","signoutCallback","useReplaceToNavigate","data","status","Fail","Success","Redirect","undefined","fetch","ApiAuthorizationClientConfigurationUrl","ok","settings","json","automaticSilentRenew","includeIdTokenInSilentRenew","events","addUserSignedOut","removeUser","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\ricar\\source\\repos\\kabudjy\\Doyou2\\ClientApp\\src\\api-authorization\\authorize.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { User, UserManager } from 'oidc-client';\r\nimport { BehaviorSubject, concat, from, Observable } from 'rxjs';\r\nimport { filter, map, mergeMap, take, tap } from 'rxjs/operators';\r\nimport { ApplicationPaths, ApplicationName } from './api-authorization.constants';\r\n\r\nexport type IAuthenticationResult =\r\n  SuccessAuthenticationResult |\r\n  FailureAuthenticationResult |\r\n  RedirectAuthenticationResult;\r\n\r\nexport interface SuccessAuthenticationResult {\r\n  status: AuthenticationResultStatus.Success;\r\n  state: any;\r\n}\r\n\r\nexport interface FailureAuthenticationResult {\r\n  status: AuthenticationResultStatus.Fail;\r\n  message: string;\r\n}\r\n\r\nexport interface RedirectAuthenticationResult {\r\n  status: AuthenticationResultStatus.Redirect;\r\n}\r\n\r\nexport enum AuthenticationResultStatus {\r\n  Success,\r\n  Redirect,\r\n  Fail\r\n}\r\n\r\nexport interface IUser {\r\n  name?: string;\r\n  isAdmin?: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthorizeService {\r\n  // By default pop ups are disabled because they don't work properly on Edge.\r\n  // If you want to enable pop up authentication simply set this flag to false.\r\n\r\n  private popUpDisabled = true;\r\n  private userManager?: UserManager;\r\n  private userSubject: BehaviorSubject<IUser | null> = new BehaviorSubject<IUser | null>(null);\r\n\r\n  public isAuthenticated(): Observable<boolean> {\r\n    return this.getUser().pipe(map(u => !!u));\r\n\r\n  }\r\n\r\n  public getUser(): Observable<IUser | null> {\r\n    return concat(\r\n      this.userSubject.pipe(take(1), filter(u => !!u)),\r\n      this.getUserFromStorage().pipe(filter(u => !!u), tap(u => this.userSubject.next(u))),\r\n      this.userSubject.asObservable());\r\n  }\r\n\r\n  public getAccessToken(): Observable<string | null> {\r\n    return from(this.ensureUserManagerInitialized())\r\n      .pipe(mergeMap(() => from(this.userManager!.getUser())),\r\n        map(user => user && user.access_token));\r\n  }\r\n\r\n  // We try to authenticate the user in three different ways:\r\n  // 1) We try to see if we can authenticate the user silently. This happens\r\n  //    when the user is already logged in on the IdP and is done using a hidden iframe\r\n  //    on the client.\r\n  // 2) We try to authenticate the user using a PopUp Window. This might fail if there is a\r\n  //    Pop-Up blocker or the user has disabled PopUps.\r\n  // 3) If the two methods above fail, we redirect the browser to the IdP to perform a traditional\r\n  //    redirect flow.\r\n  public async signIn(state: any): Promise<IAuthenticationResult> {\r\n    await this.ensureUserManagerInitialized();\r\n    let user: User | null = null;\r\n    try {\r\n      user = await this.userManager!.signinSilent(this.createArguments());\r\n      this.userSubject.next(user.profile);\r\n      return this.success(state);\r\n    } catch (silentError) {\r\n      // User might not be authenticated, fallback to popup authentication\r\n      console.log('Silent authentication error: ', silentError);\r\n\r\n      try {\r\n        if (this.popUpDisabled) {\r\n          throw new Error('Popup disabled. Change \\'authorize.service.ts:AuthorizeService.popupDisabled\\' to false to enable it.');\r\n        }\r\n        user = await this.userManager!.signinPopup(this.createArguments());\r\n        this.userSubject.next(user.profile);\r\n        return this.success(state);\r\n      } catch (popupError: any) {\r\n        if (popupError.message === 'Popup window closed') {\r\n          // The user explicitly cancelled the login action by closing an opened popup.\r\n          return this.error('The user closed the window.');\r\n        } else if (!this.popUpDisabled) {\r\n          console.log('Popup authentication error: ', popupError);\r\n        }\r\n\r\n        // PopUps might be blocked by the user, fallback to redirect\r\n        try {\r\n          await this.userManager!.signinRedirect(this.createArguments(state));\r\n          return this.redirect();\r\n        } catch (redirectError: any) {\r\n          console.log('Redirect authentication error: ', redirectError);\r\n          return this.error(redirectError);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public async completeSignIn(url: string): Promise<IAuthenticationResult> {\r\n    try {\r\n      await this.ensureUserManagerInitialized();\r\n      const user = await this.userManager!.signinCallback(url);\r\n      this.userSubject.next(user && user.profile);\r\n      return this.success(user && user.state);\r\n    } catch (error) {\r\n      console.log('There was an error signing in: ', error);\r\n      return this.error('There was an error signing in.');\r\n    }\r\n  }\r\n\r\n  public async signOut(state: any): Promise<IAuthenticationResult> {\r\n    try {\r\n      if (this.popUpDisabled) {\r\n        throw new Error('Popup disabled. Change \\'authorize.service.ts:AuthorizeService.popupDisabled\\' to false to enable it.');\r\n      }\r\n\r\n      await this.ensureUserManagerInitialized();\r\n      await this.userManager!.signoutPopup(this.createArguments());\r\n      this.userSubject.next(null);\r\n      return this.success(state);\r\n    } catch (popupSignOutError: any) {\r\n      console.log('Popup signout error: ', popupSignOutError);\r\n      try {\r\n        await this.userManager!.signoutRedirect(this.createArguments(state));\r\n        return this.redirect();\r\n      } catch (redirectSignOutError: any) {\r\n        console.log('Redirect signout error: ', redirectSignOutError);\r\n        return this.error(redirectSignOutError);\r\n      }\r\n    }\r\n  }\r\n\r\n  public async completeSignOut(url: string): Promise<IAuthenticationResult> {\r\n    await this.ensureUserManagerInitialized();\r\n    try {\r\n      const response = await this.userManager!.signoutCallback(url);\r\n      this.userSubject.next(null);\r\n      return this.success(response && response.state);\r\n    } catch (error: any) {\r\n      console.log(`There was an error trying to log out '${error}'.`);\r\n      return this.error(error);\r\n    }\r\n  }\r\n\r\n  private createArguments(state?: any): any {\r\n    return { useReplaceToNavigate: true, data: state };\r\n  }\r\n\r\n  private error(message: string): IAuthenticationResult {\r\n    return { status: AuthenticationResultStatus.Fail, message };\r\n  }\r\n\r\n  private success(state: any): IAuthenticationResult {\r\n    return { status: AuthenticationResultStatus.Success, state };\r\n  }\r\n\r\n  private redirect(): IAuthenticationResult {\r\n    return { status: AuthenticationResultStatus.Redirect };\r\n  }\r\n\r\n  private async ensureUserManagerInitialized(): Promise<void> {\r\n    if (this.userManager !== undefined) {\r\n      return;\r\n    }\r\n\r\n    const response = await fetch(ApplicationPaths.ApiAuthorizationClientConfigurationUrl);\r\n    if (!response.ok) {\r\n      throw new Error(`Could not load settings for '${ApplicationName}'`);\r\n    }\r\n\r\n    const settings: any = await response.json();\r\n    settings.automaticSilentRenew = true;\r\n    settings.includeIdTokenInSilentRenew = true;\r\n    this.userManager = new UserManager(settings);\r\n\r\n    this.userManager.events.addUserSignedOut(async () => {\r\n      await this.userManager!.removeUser();\r\n      this.userSubject.next(null);\r\n    });\r\n  }\r\n\r\n  private getUserFromStorage(): Observable<IUser | null> {\r\n    return from(this.ensureUserManagerInitialized())\r\n      .pipe(\r\n        mergeMap(() => this.userManager!.getUser()),\r\n        map(u => u && u.profile));\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}